generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model AdminUser {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("admin_users")
}

model Team {
  id          String   @id @default(uuid()) @db.Uuid
  name        String
  slug        String   @unique
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  inviteLinks  InviteLink[]
  participants Participant[]
  moodEntries  MoodEntry[]

  @@map("teams")
}

model InviteLink {
  id        String    @id @default(uuid()) @db.Uuid
  teamId    String    @map("team_id") @db.Uuid
  tokenHash String    @unique @map("token_hash")
  isActive  Boolean   @default(true) @map("is_active")
  expiresAt DateTime? @map("expires_at")
  createdAt DateTime  @default(now()) @map("created_at")

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@map("invite_links")
}

model Participant {
  id        String   @id @default(uuid()) @db.Uuid
  teamId    String   @map("team_id") @db.Uuid
  nickname  String?
  deviceId  String   @map("device_id")
  createdAt DateTime @default(now()) @map("created_at")

  team        Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)
  moodEntries MoodEntry[]

  @@unique([teamId, deviceId])
  @@map("participants")
}

model MoodEntry {
  id            String   @id @default(uuid()) @db.Uuid
  teamId        String   @map("team_id") @db.Uuid
  participantId String   @map("participant_id") @db.Uuid
  mood          Int      @db.SmallInt // 1-5 scale
  comment       String?
  createdAt     DateTime @default(now()) @map("created_at")
  entryDate     DateTime @default(now()) @map("entry_date") @db.Date

  team        Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)
  participant Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([participantId, entryDate])
  @@map("mood_entries")
}
